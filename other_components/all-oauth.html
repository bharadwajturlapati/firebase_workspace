<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/firebase-element/firebase-auth.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">

<dom-module id="all-oauth">
  <template>
    <firebase-auth id="firebaseLogin" user="{{user}}" status-known="{{statusKnown}}" location="resplendent-fire-9817.firebaseio.com" provider="google" on-error="errorHandler" on-user-created="userSuccessHandler" on-password-changed="userSuccessHandler" on-password-reset="userSuccessHandler" on-user-removed="userSuccessHandler"></firebase-auth>
	
    <button  id = "google" class="btn btn-primary" hidden$="{{computeLoginHidden(statusKnown, user)}}">Connect with Google</button>
	<button  id = "facebook" class="btn btn-primary" hidden$="{{computeLoginHidden(statusKnown, user)}}">Connect with Facebook</button>
	<button  id = "github" class="btn btn-primary"  hidden$="{{computeLoginHidden(statusKnown, user)}}">Connect with Github</button>
    <!--<button on-tap="logout" hidden$="{{computeLogoutHidden(statusKnown, user)}}">Logout</button>-->

  </template>
</dom-module>
<script>
  Polymer({
    is: 'all-oauth',
	listeners: {
        'google.tap': 'login',
		'facebook.tap' :'lfacebook',
		'github.tap':'lgithub'
      },

    properties: {
      provider: {
        type: String,
        value: 'anonymous'
      },

      message: {
        type: String,
        value: ''
      },

      email: {
        type: String,
        value: ''
      },

      password: {
        type: String,
        value: ''
      },

      user: {
        type: Object,
        value: null
      },

      statusKnown: {
        type: Boolean
      },
	  google: {
        type: String,
		value: 'google'
      },
	  anonymous: {
        type: String,
		value: 'anonymous'
      },
	  twitter: {
        type: String,
		value: 'twitter'
      },
	  password: {
        type: String,
		value: 'password'
      },
	  github: {
        type: String,
		value: 'github'
      }
	  
    },

    logout: function() {
      this.$.firebaseLogin.logout();
    },

    errorHandler: function(e) {
      this.message = 'Error: ' + e.detail.message;
    },

    userSuccessHandler: function(e) {
      this.message = e.type + ' success!';
    },

    createUserHandler: function(e) {
      this.$.firebaseLogin.createUser(this.email, this.password);
    },

    changePasswordHandler: function(e) {
      this.$.firebaseLogin.changePassword(this.email, this.password, this.newPassword);
    },

    resetPasswordHandler: function(e) {
      this.$.firebaseLogin.sendPasswordResetEmail(this.email);
    },

    removeUserHandler: function(e) {
      this.$.firebaseLogin.removeUser(this.email, this.password);
    },

    computePasswordHidden: function(provider) {
      return provider !== 'password';
    },

    computeCreateUserDisabled: function(email, password) {
      return !email || !password;
    },

    computeChangePasswordDisabled: function(email, password, newPassword) {
      return !email || !password || !newPassword;
    },

    computeResetPasswordDisabled: function(email, password) {
      return !email || !password;
    },

    computeRemoveUserDisabled: function(email, password) {
      return !email || !password;
    },

    computeLoginHidden: function(statusKnown, user) {
		if(statusKnown&&user&&this.$.firebaseLogin.provider=="google"){
			window.location.href="index.html"+"#"+user.google.displayName+"&"+user.uid;
		}
      return !statusKnown || !!user;
    },

    computeLogoutHidden: function(statusKnown, user) {
      return !statusKnown || !user;
    },

    computeLoginStatus: function(statusKnown, user) {
      if (statusKnown && user) {
        return 'Logged in';
      }

      if (statusKnown) {
        return 'Logged out';
      }

      return 'Unknown (checking status...)';
    },
	 login: function(statusKnown, user,provider) {
      var params;
	  var firebasenode = document.getElementById("firebaseLogin");
	  firebasenode.setAttribute("provider","google");
      try {
        params = JSON.parse(this.params);
      } catch (e) {
        params = null;
      }

      if (this.provider == 'password') {
        params = params || {};
        params.email = this.email;
        params.password = this.password;
      }
		//this.repl.auth.provider = this.$.firebaseLogin.provider;
      this.$.firebaseLogin.login(params);
    },
	lfacebook: function(statusKnown, user,provider) {
      var params;
	  var firebasenode = document.getElementById("firebaseLogin");
	  firebasenode.setAttribute("provider","facebook");
      try {
        params = JSON.parse(this.params);
      } catch (e) {
        params = null;
      }

      if (this.provider == 'password') {
        params = params || {};
        params.email = this.email;
        params.password = this.password;
      }
		//this.repl.auth.provider = this.$.firebaseLogin.provider;
      this.$.firebaseLogin.login(params);
    },
	lgithub: function(statusKnown, user,provider) {
      var params;
	  var firebasenode = document.getElementById("firebaseLogin");
	  firebasenode.setAttribute("provider","github");
      try {
        params = JSON.parse(this.params);
      } catch (e) {
        params = null;
      }

      if (this.provider == 'password') {
        params = params || {};
        params.email = this.email;
        params.password = this.password;
      }
		//this.repl.auth.provider = this.$.firebaseLogin.provider;
      this.$.firebaseLogin.login(params);
    }
  });
 
</script>
